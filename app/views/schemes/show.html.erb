<% title = @scheme.service_name %>
<% content_for :title, title %>

<% if current_user.support? %>
  <% content_for :breadcrumbs, govuk_breadcrumbs(breadcrumbs: {
    "Schemes (#{@scheme.owning_organisation.name})" => schemes_organisation_path(@scheme.owning_organisation),
    content_for(:title) => "",
  }) %>
<% else %>
  <% content_for :before_content do %>
    <%= govuk_back_link(
          href: schemes_path,
          ) %>
  <% end %>
<% end %>

<%= render partial: "organisations/headings", locals: { main: @scheme.service_name, sub: nil } %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">
    <%= render SubNavigationComponent.new(items: scheme_items(request.path, @scheme.id)) %>

    <h2 class="govuk-visually-hidden">Scheme</h2>
    <%= govuk_inset_text(text: edit_scheme_text(@scheme, current_user)) %>

    <%= govuk_summary_list do |summary_list| %>
      <% display_scheme_attributes(@scheme).each do |attr| %>
        <%= summary_list.row do |row| %>
          <% row.key { attr[:name] } %>
          <% row.value do %>
            <%= details_html(attr) %>
            <% if attr[:name] == "Status" && @scheme.confirmed? && @scheme.locations.confirmed.none? && LocationPolicy.new(current_user, @scheme.locations.new).create? %>
              <span class="app-!-colour-muted">Complete this scheme by adding a location using the <%= govuk_link_to("‘locations’ tab", scheme_locations_path(@scheme)) %>.</span>
            <% end %>
          <% end %>
          <% if SchemePolicy.new(current_user, @scheme).update? %>
            <% row.action(text: "Change", href: scheme_edit_name_path(scheme_id: @scheme.id)) if attr[:edit] %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<% if SchemePolicy.new(current_user, @scheme).deactivate? %>
  <%= toggle_scheme_link(@scheme) %>
<% end %>
